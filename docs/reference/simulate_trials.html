<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Simulate clinical trials. — simulate_trials • escalation</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate clinical trials. — simulate_trials"><meta name="description" content="This function takes a selector_factory, such as
  that returned by get_dfcrm, get_boin or
  get_three_plus_three, and conducts many notional clinical
  trials. We conduct simulations to learn about the operating characteristics
  of adaptive trial designs."><meta property="og:description" content="This function takes a selector_factory, such as
  that returned by get_dfcrm, get_boin or
  get_three_plus_three, and conducts many notional clinical
  trials. We conduct simulations to learn about the operating characteristics
  of adaptive trial designs."><meta property="og:image" content="/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">escalation</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/A100-DoseSelectors.html">Using escalation</a></li>
    <li><a class="dropdown-item" href="../articles/A205-CRM.html">CRM - Continual Reassessment Method</a></li>
    <li><a class="dropdown-item" href="../articles/A207-NBG.html">NBG - Neuenschwander, Branson &amp; Gsponer</a></li>
    <li><a class="dropdown-item" href="../articles/A210-TPI.html">TPI - Toxicity Probability Interval Design</a></li>
    <li><a class="dropdown-item" href="../articles/A220-mTPI.html">mTPI - Modified Toxicity Probability Interval Design</a></li>
    <li><a class="dropdown-item" href="../articles/A230-BOIN.html">BOIN - Bayesian Optimal Interval Design</a></li>
    <li><a class="dropdown-item" href="../articles/A280-TITE.html">TITE-CRM and TITE-NBG - Time-to-Event Designs</a></li>
    <li><a class="dropdown-item" href="../articles/A310-EfficacyToxicity.html">EffTox, Wages &amp; Tait, and BOIN12 - Efficacy &amp; Toxicity Designs</a></li>
    <li><a class="dropdown-item" href="../articles/A360-Combinations.html">BOIN-COMB - Treatment Combination Designs</a></li>
    <li><a class="dropdown-item" href="../articles/A600-DosePaths.html">Working with dose-paths</a></li>
    <li><a class="dropdown-item" href="../articles/A700-Simulation.html">Simulating dose-escalation trials</a></li>
    <li><a class="dropdown-item" href="../articles/A710-SimulationComparison.html">Comparing dose-escalation designs by simulation</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/brockk/escalation/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Simulate clinical trials.</h1>
      <small class="dont-index">Source: <a href="https://github.com/brockk/escalation/blob/HEAD/R/simulate_trials.R" class="external-link"><code>R/simulate_trials.R</code></a></small>
      <div class="d-none name"><code>simulate_trials.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function takes a <code><a href="selector_factory.html">selector_factory</a></code>, such as
  that returned by <code><a href="get_dfcrm.html">get_dfcrm</a></code>, <code><a href="get_boin.html">get_boin</a></code> or
  <code><a href="get_three_plus_three.html">get_three_plus_three</a></code>, and conducts many notional clinical
  trials. We conduct simulations to learn about the operating characteristics
  of adaptive trial designs.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">simulate_trials</span><span class="op">(</span></span>
<span>  <span class="va">selector_factory</span>,</span>
<span>  <span class="va">num_sims</span>,</span>
<span>  <span class="va">true_prob_tox</span>,</span>
<span>  true_prob_eff <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-selector-factory">selector_factory<a class="anchor" aria-label="anchor" href="#arg-selector-factory"></a></dt>
<dd><p>Object of type <code><a href="selector_factory.html">selector_factory</a></code>.</p></dd>


<dt id="arg-num-sims">num_sims<a class="anchor" aria-label="anchor" href="#arg-num-sims"></a></dt>
<dd><p>integer, number of trial iterations to simulate.</p></dd>


<dt id="arg-true-prob-tox">true_prob_tox<a class="anchor" aria-label="anchor" href="#arg-true-prob-tox"></a></dt>
<dd><p>numeric vector of true but unknown toxicity
probabilities</p></dd>


<dt id="arg-true-prob-eff">true_prob_eff<a class="anchor" aria-label="anchor" href="#arg-true-prob-eff"></a></dt>
<dd><p>numeric vector of true but unknown efficacy
probabilities. NULL if efficacy not analysed.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Extra args are passed onwards.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Object of type <code><a href="simulations.html">simulations</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>By default, dose decisions in simulated trials are made after each
  cohort of 3 patients. This can be changed by providing a function by the
  <code>sample_patient_arrivals</code> parameter that simulates the arrival of new
  patients. The new patients will be added to the existing patients and the
  model will be fit to the set of all patients. The function that simulates
  patient arrivals should take as a single parameter a data-frame with one
  row for each existing patient and columns including cohort, patient, dose,
  tox, time (and possibly also eff and weight, if a phase I/II or
  time-to-event method is used). The provision of data on the existing
  patients allows the patient sampling function to be adaptive. The function
  should return a data-frame with a row for each new patient and a column for
  time_delta, the time between the arrival of this patient and the previous,
  as in <code><a href="cohorts_of_n.html">cohorts_of_n</a></code>. See Examples.</p>
<p>This method can simulate the culmination of trials that are partly
  completed. We just have to specify the outcomes already observed via the
  <code>previous_outcomes</code> parameter. Each simulated trial will commence from
  those outcomes seen thus far. See Examples.</p>
<p>We can specify the immediate next dose by specifying <code>next_dose</code>. If
  omitted, the next dose is calculated by invoking the model on the outcomes
  seen thus far.</p>
<p>Designs must eventually choose to stop the trial. Some designs, like 3+3,
  have intrinsic stopping rules. However, some selectors like those derived
  from <code><a href="get_dfcrm.html">get_dfcrm</a></code> offer no default stopping method. You may need
  to append stopping behaviour to your selector via something like
  <code><a href="stop_at_n.html">stop_at_n</a></code> or <code><a href="stop_when_n_at_dose.html">stop_when_n_at_dose</a></code>, etc. To
  safeguard against simulating runaway trials that never end, the function
  will halt a simulated trial after 30 invocations of the dose-selection
  decision. To breach this limit, specify <code>i_like_big_trials = TRUE</code> in
  the function call. However, when you forego the safety net, the onus is on
  you to write selectors that will eventually stop the trial! See Examples.</p>
<p>The model is fit to the prevailing data at each dose selection point. By
  default, only the final model fit for each simulated trial is retained.
  This is done to conserve memory. With a high number of simulated trials,
  storing many model fits per trial may cause the executing machine to run
  out of memory. However, you can force this method to retain all model fits
  by specifying <code>return_all_fits = TRUE</code>. See Examples.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="simulations.html">simulations</a></code></p>
<p><code><a href="selector_factory.html">selector_factory</a></code></p>
<p><code><a href="get_dfcrm.html">get_dfcrm</a></code></p>
<p><code><a href="get_boin.html">get_boin</a></code></p>
<p><code><a href="get_three_plus_three.html">get_three_plus_three</a></code></p>
<p><code><a href="cohorts_of_n.html">cohorts_of_n</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># In a five-dose scenario, we have assumed probabilities for Prob(tox):</span></span></span>
<span class="r-in"><span><span class="va">true_prob_tox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.12</span>, <span class="fl">0.27</span>, <span class="fl">0.44</span>, <span class="fl">0.53</span>, <span class="fl">0.57</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulate ten 3+3 trials:</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_three_plus_three.html">get_three_plus_three</a></span><span class="op">(</span>num_doses <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">simulate_trials</span><span class="op">(</span>num_sims <span class="op">=</span> <span class="fl">10</span>, true_prob_tox <span class="op">=</span> <span class="va">true_prob_tox</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Likewise, simulate 10 trials using a continual reassessment method:</span></span></span>
<span class="r-in"><span><span class="va">skeleton</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">target</span> <span class="op">&lt;-</span> <span class="fl">0.25</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_dfcrm.html">get_dfcrm</a></span><span class="op">(</span>skeleton <span class="op">=</span> <span class="va">skeleton</span>, target <span class="op">=</span> <span class="va">target</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="stop_at_n.html">stop_at_n</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">simulate_trials</span><span class="op">(</span>num_sims <span class="op">=</span> <span class="fl">10</span>, true_prob_tox <span class="op">=</span> <span class="va">true_prob_tox</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Lots of useful information is contained in the returned object:</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="num_patients.html">num_patients</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 12 12 12 12 12 12 12 12 12 12</span>
<span class="r-in"><span><span class="va">sims</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="num_doses.html">num_doses</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 5</span>
<span class="r-in"><span><span class="va">sims</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="dose_indices.html">dose_indices</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 2 3 4 5</span>
<span class="r-in"><span><span class="va">sims</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="n_at_dose.html">n_at_dose</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 10 × 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      `1`   `2`   `3`   `4`   `5`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>     3     3     3     3     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>     3     6     0     3     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>     6     6     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>     3     3     3     3     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>     9     3     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>     6     6     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>     3     3     3     3     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>     3     3     3     3     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>     3     6     0     3     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>    12     0     0     0     0</span>
<span class="r-in"><span><span class="va">sims</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="n_at_recommended_dose.html">n_at_recommended_dose</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  3  3  0  3  9  6  3  3  3 12</span>
<span class="r-in"><span><span class="va">sims</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="tox_at_dose.html">tox_at_dose</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 10 × 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      `1`   `2`   `3`   `4`   `5`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>     0     0     0     2     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>     0     3     0     2     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>     1     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>     0     2     2     1     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>     1     2     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>     1     1     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>     0     0     0     2     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>     0     1     2     1     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>     0     3     0     2     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>     3     0     0     0     0</span>
<span class="r-in"><span><span class="va">sims</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="num_tox.html">num_tox</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 2 5 1 5 3 2 2 4 5 3</span>
<span class="r-in"><span><span class="va">sims</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="recommended_dose.html">recommended_dose</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 3 1 3 1 1 2 3 2 1 1</span>
<span class="r-in"><span><span class="va">sims</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="prob_administer.html">prob_administer</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1     2     3     4     5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.425 0.325 0.100 0.150 0.000 </span>
<span class="r-in"><span><span class="va">sims</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="prob_recommend.html">prob_recommend</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NoDose      1      2      3      4      5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    0.0    0.5    0.2    0.3    0.0    0.0 </span>
<span class="r-in"><span><span class="va">sims</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="trial_duration.html">trial_duration</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  8.487783 14.737913 14.678805 10.590806 11.573965 15.094672  9.161286</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8] 10.530829 12.972661 13.029242</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># By default, dose decisions are made after each cohort of 3 patients. See</span></span></span>
<span class="r-in"><span><span class="co"># Details. To override, specify an alternative function via the</span></span></span>
<span class="r-in"><span><span class="co"># sample_patient_arrivals parameter. E.g. to use cohorts of 2, we run:</span></span></span>
<span class="r-in"><span><span class="va">patient_arrivals_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">current_data</span><span class="op">)</span> <span class="fu"><a href="cohorts_of_n.html">cohorts_of_n</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_dfcrm.html">get_dfcrm</a></span><span class="op">(</span>skeleton <span class="op">=</span> <span class="va">skeleton</span>, target <span class="op">=</span> <span class="va">target</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="stop_at_n.html">stop_at_n</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">simulate_trials</span><span class="op">(</span>num_sims <span class="op">=</span> <span class="fl">10</span>, true_prob_tox <span class="op">=</span> <span class="va">true_prob_tox</span>,</span></span>
<span class="r-in"><span>    sample_patient_arrivals <span class="op">=</span> <span class="va">patient_arrivals_func</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># To simulate the culmination of trials that are partly completed, specify</span></span></span>
<span class="r-in"><span><span class="co"># the outcomes already observed via the previous_outcomes parameter. Imagine</span></span></span>
<span class="r-in"><span><span class="co"># one cohort has already been evaluated, returning outcomes 1NTN. We can</span></span></span>
<span class="r-in"><span><span class="co"># simulate the remaining part of the trial with:</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_dfcrm.html">get_dfcrm</a></span><span class="op">(</span>skeleton <span class="op">=</span> <span class="va">skeleton</span>, target <span class="op">=</span> <span class="va">target</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="stop_at_n.html">stop_at_n</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">simulate_trials</span><span class="op">(</span>num_sims <span class="op">=</span> <span class="fl">10</span>, true_prob_tox <span class="op">=</span> <span class="va">true_prob_tox</span>,</span></span>
<span class="r-in"><span>                  previous_outcomes <span class="op">=</span> <span class="st">'1NTN'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Outcomes can be described by the above outcome string method or data-frame:</span></span></span>
<span class="r-in"><span>  <span class="va">previous_outcomes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    patient <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span></span>
<span class="r-in"><span>    cohort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    tox <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    dose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_dfcrm.html">get_dfcrm</a></span><span class="op">(</span>skeleton <span class="op">=</span> <span class="va">skeleton</span>, target <span class="op">=</span> <span class="va">target</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="stop_at_n.html">stop_at_n</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">simulate_trials</span><span class="op">(</span>num_sims <span class="op">=</span> <span class="fl">10</span>, true_prob_tox <span class="op">=</span> <span class="va">true_prob_tox</span>,</span></span>
<span class="r-in"><span>                  previous_outcomes <span class="op">=</span> <span class="va">previous_outcomes</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We can specify the immediate next dose:</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_dfcrm.html">get_dfcrm</a></span><span class="op">(</span>skeleton <span class="op">=</span> <span class="va">skeleton</span>, target <span class="op">=</span> <span class="va">target</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="stop_at_n.html">stop_at_n</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">simulate_trials</span><span class="op">(</span>num_sims <span class="op">=</span> <span class="fl">10</span>, true_prob_tox <span class="op">=</span> <span class="va">true_prob_tox</span>,</span></span>
<span class="r-in"><span>                  next_dose <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># By default, the method will stop simulated trials after 30 dose selections.</span></span></span>
<span class="r-in"><span><span class="co"># To suppress this, specify i_like_big_trials = TRUE. However, please take</span></span></span>
<span class="r-in"><span><span class="co"># care to specify selectors that will eventually stop!</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_dfcrm.html">get_dfcrm</a></span><span class="op">(</span>skeleton <span class="op">=</span> <span class="va">skeleton</span>, target <span class="op">=</span> <span class="va">target</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="stop_at_n.html">stop_at_n</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">99</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">simulate_trials</span><span class="op">(</span>num_sims <span class="op">=</span> <span class="fl">1</span>, true_prob_tox <span class="op">=</span> <span class="va">true_prob_tox</span>,</span></span>
<span class="r-in"><span>                  i_like_big_trials <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># By default, only the final model fit is retained for each simulated trial.</span></span></span>
<span class="r-in"><span><span class="co"># To retain all interim model fits, specify return_all_fits = TRUE.</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_three_plus_three.html">get_three_plus_three</a></span><span class="op">(</span>num_doses <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">simulate_trials</span><span class="op">(</span>num_sims <span class="op">=</span> <span class="fl">10</span>, true_prob_tox <span class="op">=</span> <span class="va">true_prob_tox</span>,</span></span>
<span class="r-in"><span>                  return_all_fits <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Verify that there are now many analyses per trial with:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">sims</span><span class="op">$</span><span class="va">fits</span>, <span class="va">length</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 4 5 4 3 4 7 4 6 6 4</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kristian Brock, Daniel Slade, Michael Sweeting.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

