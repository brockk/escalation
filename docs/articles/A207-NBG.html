<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neuenschwander, Branson &amp; Gsponer • escalation</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Neuenschwander, Branson &amp; Gsponer">
<meta property="og:description" content="escalation">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">escalation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/A100-DoseSelectors.html">Using escalation</a>
    </li>
    <li>
      <a href="../articles/A205-CRM.html">Continual Reassessment Method</a>
    </li>
    <li>
      <a href="../articles/A207-NBG.html">Neuenschwander, Branson &amp; Gsponer</a>
    </li>
    <li>
      <a href="../articles/A210-TPI.html">Toxicity Probability Interval Design</a>
    </li>
    <li>
      <a href="../articles/A220-mTPI.html">Modified Toxicity Probability Interval Design</a>
    </li>
    <li>
      <a href="../articles/A230-BOIN.html">Bayesian Optimal Interval Design</a>
    </li>
    <li>
      <a href="../articles/A600-DosePaths.html">Working with dose-paths</a>
    </li>
    <li>
      <a href="../articles/A700-Simulation.html">Simulating dose-escalation trials</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="A207-NBG_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="A207-NBG_files/htmlwidgets-1.5.2/htmlwidgets.js"></script><script src="A207-NBG_files/viz-1.8.2/viz.js"></script><link href="A207-NBG_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="A207-NBG_files/grViz-binding-1.0.6.1/grViz.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Neuenschwander, Branson &amp; Gsponer</h1>
            
      
      
      <div class="hidden name"><code>A207-NBG.Rmd</code></div>

    </div>

    
    
<div id="summary-of-the-design" class="section level1">
<h1 class="hasAnchor">
<a href="#summary-of-the-design" class="anchor"></a>Summary of the design</h1>
<p><span class="citation">Neuenschwander, Branson, and Gsponer (2008)</span> (NBG) introduced a derivative of the CRM for dose-escalation clinical trials using the model:</p>
<p><span class="math display">\[ \text{logit} p_i = \alpha + \exp{(\beta)} \log{(x_i / d^*)}, \]</span></p>
<p>where <span class="math inline">\(p_i\)</span> is the probability of toxicity at the <span class="math inline">\(i\)</span>th dose, <span class="math inline">\(x_i\)</span>, and <span class="math inline">\(d^*\)</span> is a reference dose. Here <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> are model parameters on which the authors place a bivariate normal prior. This model is very similar to the two-parameter logistic CRM, implemented with <code>stan_crm(model = 'logistic2')</code>. However, a notable difference is that the dose, <span class="math inline">\(x_i\)</span>, enters the model as a covariate. This dispenses with the toxicity skeleton that is used in the CRM.</p>
</div>
<div id="implementation-in-escalation" class="section level1">
<h1 class="hasAnchor">
<a href="#implementation-in-escalation" class="anchor"></a>Implementation in <code>escalation</code>
</h1>
<p>The heavy lifting required to fit the model is performed by <code>trialr</code> and <code>rstan</code>. <code>escalation</code> merely composes the model fit in such a way that it can be used with the myriad dose-selection option provided in this package.</p>
<p>For illustration, let us reproduce the analysis in <span class="citation">Neuenschwander, Branson, and Gsponer (2008)</span> that the authors used to demonstrate the flexibility of a two-parameter approach. In a trial of 15 doses, the investigators saw outcomes:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">escalation</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: magrittr</span>

<span class="va">dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2.5</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">25</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span>, <span class="fl">75</span>, <span class="fl">100</span>, <span class="fl">150</span>, <span class="fl">200</span>, <span class="fl">250</span><span class="op">)</span>
<span class="va">outcomes</span> <span class="op">&lt;-</span> <span class="st">'1NNN 2NNNN 3NNNN 4NNNN 7TT'</span></pre></div>
<p>Creating a dose-escalation model with NBG’s parameters:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_trialr_nbg.html">get_trialr_nbg</a></span><span class="op">(</span>real_doses <span class="op">=</span> <span class="va">dose</span>, d_star <span class="op">=</span> <span class="fl">250</span>, target <span class="op">=</span> <span class="fl">0.3</span>,
                        alpha_mean <span class="op">=</span> <span class="fl">2.15</span>, alpha_sd <span class="op">=</span> <span class="fl">0.84</span>,
                        beta_mean <span class="op">=</span> <span class="fl">0.52</span>, beta_sd <span class="op">=</span> <span class="fl">0.8</span>,
                        seed <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span></pre></div>
<p>and fitting the model to the observed outcomes:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/fit.html">fit</a></span><span class="op">(</span><span class="va">outcomes</span><span class="op">)</span>
<span class="va">fit</span>
<span class="co">#&gt; Patient-level data:</span>
<span class="co">#&gt; # A tibble: 17 x 4</span>
<span class="co">#&gt;    Patient Cohort  Dose   Tox</span>
<span class="co">#&gt;      &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1       1      1     1     0</span>
<span class="co">#&gt;  2       2      1     1     0</span>
<span class="co">#&gt;  3       3      1     1     0</span>
<span class="co">#&gt;  4       4      2     2     0</span>
<span class="co">#&gt;  5       5      2     2     0</span>
<span class="co">#&gt;  6       6      2     2     0</span>
<span class="co">#&gt;  7       7      2     2     0</span>
<span class="co">#&gt;  8       8      3     3     0</span>
<span class="co">#&gt;  9       9      3     3     0</span>
<span class="co">#&gt; 10      10      3     3     0</span>
<span class="co">#&gt; 11      11      3     3     0</span>
<span class="co">#&gt; 12      12      4     4     0</span>
<span class="co">#&gt; 13      13      4     4     0</span>
<span class="co">#&gt; 14      14      4     4     0</span>
<span class="co">#&gt; 15      15      4     4     0</span>
<span class="co">#&gt; 16      16      5     7     1</span>
<span class="co">#&gt; 17      17      5     7     1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Dose-level data:</span>
<span class="co">#&gt; # A tibble: 16 x 9</span>
<span class="co">#&gt;    RealDose dose    tox     n empiric_tox_rate mean_prob_tox median_prob_tox</span>
<span class="co">#&gt;       &lt;dbl&gt; &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;         &lt;dbl&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt;  1     NA   NoDo…     0     0                0        0              0      </span>
<span class="co">#&gt;  2      1   1         0     3                0        0.0126         0.00563</span>
<span class="co">#&gt;  3      2.5 2         0     4                0        0.0325         0.0197 </span>
<span class="co">#&gt;  4      5   3         0     4                0        0.0675         0.0493 </span>
<span class="co">#&gt;  5     10   4         0     4                0        0.138          0.119  </span>
<span class="co">#&gt;  6     15   5         0     0              NaN        0.206          0.189  </span>
<span class="co">#&gt;  7     20   6         0     0              NaN        0.269          0.256  </span>
<span class="co">#&gt;  8     25   7         2     2                1        0.326          0.319  </span>
<span class="co">#&gt;  9     30   8         0     0              NaN        0.378          0.374  </span>
<span class="co">#&gt; 10     40   9         0     0              NaN        0.466          0.469  </span>
<span class="co">#&gt; 11     50   10        0     0              NaN        0.537          0.547  </span>
<span class="co">#&gt; 12     75   11        0     0              NaN        0.662          0.677  </span>
<span class="co">#&gt; 13    100   12        0     0              NaN        0.739          0.758  </span>
<span class="co">#&gt; 14    150   13        0     0              NaN        0.826          0.847  </span>
<span class="co">#&gt; 15    200   14        0     0              NaN        0.872          0.893  </span>
<span class="co">#&gt; 16    250   15        0     0              NaN        0.899          0.920  </span>
<span class="co">#&gt; # … with 2 more variables: admissible &lt;lgl&gt;, recommended &lt;lgl&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The model targets a toxicity level of 0.3.</span>
<span class="co">#&gt; The model advocates continuing at dose 7.</span></pre></div>
<p>we see that dose 7 is selected for the next cohort using the metric of selecting the dose with posterior expected probability of toxicity closest to the target. In the above output, <code>mean_prob_tox</code> broadly matches the values plotted in the lower right panel of Figure 1 in <span class="citation">Neuenschwander, Branson, and Gsponer (2008)</span>.</p>
<div id="future-work" class="section level2">
<h2 class="hasAnchor">
<a href="#future-work" class="anchor"></a>Future work</h2>
<p>There are a few minor shortcomings of the NBG implementation in <code>escalation</code> &amp; <code>trialr</code>. Firstly, NBG propose a bivariate normal prior distribution on <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>. However, the implementation in <code>trialr</code> currently uses independent normal priors. Hopefully, this will be addressed in a future release of <code>trialr</code>.</p>
<p>Furthermore, NBG propose a method for selecting dose that accounts for the probability of recommending an overdose. That logic is currently not implemented in <code>escalation</code>. However, a proposal that addresses the same issue was presented by <span class="citation">Mozgunov and Jaki (2020)</span>, is implemented in <code>escalation</code>, and can be applied to the NBG method:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="va">model2</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/select_dose_by_cibp.html">select_dose_by_cibp</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></pre></div>
<p>Fitting the new model to the same outcomes:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="va">fit2</span> <span class="op">&lt;-</span> <span class="va">model2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/fit.html">fit</a></span><span class="op">(</span><span class="va">outcomes</span><span class="op">)</span></pre></div>
<p>Rather than sticking at dose 7, the design now prefers to de-escalate to dose 6:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="va">fit2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/recommended_dose.html">recommended_dose</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] 6</span></pre></div>
<p>Mozgunov &amp; Jaki’s method was published in relation to the CRM design, but it can be applied in <code>escalation</code> to any model providing posterior samples via the <code>prob_tox_samples</code> method, including Neuenschwander <em>et al.</em>’s method illustrated here.</p>
</div>
<div id="dose-paths" class="section level2">
<h2 class="hasAnchor">
<a href="#dose-paths" class="anchor"></a>Dose paths</h2>
<p>We can use the <code>get_dose_paths</code> function in <code>escalation</code> to calculate exhaustive model recommendations in response to every possible set of outcomes in future cohorts.</p>
<p>For instance, at the start of a trial using the NBG model detailed above, we can examine all possible paths a trial might take in the first two cohorts of three patients, starting at dose 2:</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">paths1</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/get_dose_paths.html">get_dose_paths</a></span><span class="op">(</span>cohort_sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, next_dose <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="../reference/graph_paths.html">graph_paths</a></span><span class="op">(</span><span class="va">paths1</span><span class="op">)</span></pre></div>
<div id="htmlwidget-3f25524ff4928532b9ac" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-3f25524ff4928532b9ac">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"2\", fontcolor = \"#35B779FF\", fillcolor = \"#472F7DFF\"] \n  \"2\" [label = \"10\", fontcolor = \"#472F7DFF\", fillcolor = \"#35B779FF\"] \n  \"3\" [label = \"12\", fontcolor = \"#39568CFF\", fillcolor = \"#7AD151FF\"] \n  \"4\" [label = \"2\", fontcolor = \"#35B779FF\", fillcolor = \"#472F7DFF\"] \n  \"5\" [label = \"4\", fontcolor = \"#7AD151FF\", fillcolor = \"#39568CFF\"] \n  \"6\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"7\" [label = \"2\", fontcolor = \"#35B779FF\", fillcolor = \"#472F7DFF\"] \n  \"8\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"9\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"10\" [label = \"9\", fontcolor = \"#481A6CFF\", fillcolor = \"#22A884FF\"] \n  \"11\" [label = \"2\", fontcolor = \"#35B779FF\", fillcolor = \"#472F7DFF\"] \n  \"12\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"13\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"14\" [label = \"6\", fontcolor = \"#D2E21BFF\", fillcolor = \"#2A788EFF\"] \n  \"15\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"16\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"17\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"18\" [label = \"4\", fontcolor = \"#7AD151FF\", fillcolor = \"#39568CFF\"] \n  \"19\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"20\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"21\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n\"1\"->\"2\" [label = \"NNN\"] \n\"2\"->\"3\" [label = \"NNN\"] \n\"1\"->\"4\" [label = \"NNT\"] \n\"4\"->\"5\" [label = \"NNN\"] \n\"1\"->\"6\" [label = \"NTT\"] \n\"6\"->\"7\" [label = \"NNN\"] \n\"1\"->\"8\" [label = \"TTT\"] \n\"8\"->\"9\" [label = \"NNN\"] \n\"2\"->\"10\" [label = \"NNT\"] \n\"4\"->\"11\" [label = \"NNT\"] \n\"6\"->\"12\" [label = \"NNT\"] \n\"8\"->\"13\" [label = \"NNT\"] \n\"2\"->\"14\" [label = \"NTT\"] \n\"4\"->\"15\" [label = \"NTT\"] \n\"6\"->\"16\" [label = \"NTT\"] \n\"8\"->\"17\" [label = \"NTT\"] \n\"2\"->\"18\" [label = \"TTT\"] \n\"4\"->\"19\" [label = \"TTT\"] \n\"6\"->\"20\" [label = \"TTT\"] \n\"8\"->\"21\" [label = \"TTT\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>We can then compare these to the similar advice from the model that adds Mozgunov &amp; Jaki’s criterion:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="va">paths2</span> <span class="op">&lt;-</span> <span class="va">model2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/get_dose_paths.html">get_dose_paths</a></span><span class="op">(</span>cohort_sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, next_dose <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="../reference/graph_paths.html">graph_paths</a></span><span class="op">(</span><span class="va">paths2</span><span class="op">)</span></pre></div>
<div id="htmlwidget-5f0ffb8ca98fe36d06d5" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-5f0ffb8ca98fe36d06d5">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"2\", fontcolor = \"#35B779FF\", fillcolor = \"#472F7DFF\"] \n  \"2\" [label = \"11\", fontcolor = \"#414487FF\", fillcolor = \"#54C568FF\"] \n  \"3\" [label = \"12\", fontcolor = \"#39568CFF\", fillcolor = \"#7AD151FF\"] \n  \"4\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"5\" [label = \"3\", fontcolor = \"#54C568FF\", fillcolor = \"#414487FF\"] \n  \"6\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"7\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"8\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"9\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"10\" [label = \"9\", fontcolor = \"#481A6CFF\", fillcolor = \"#22A884FF\"] \n  \"11\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"12\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"13\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"14\" [label = \"5\", fontcolor = \"#A5DB36FF\", fillcolor = \"#31688EFF\"] \n  \"15\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"16\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"17\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"18\" [label = \"4\", fontcolor = \"#7AD151FF\", fillcolor = \"#39568CFF\"] \n  \"19\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"20\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n  \"21\" [label = \"1\", fontcolor = \"#22A884FF\", fillcolor = \"#481A6CFF\"] \n\"1\"->\"2\" [label = \"NNN\"] \n\"2\"->\"3\" [label = \"NNN\"] \n\"1\"->\"4\" [label = \"NNT\"] \n\"4\"->\"5\" [label = \"NNN\"] \n\"1\"->\"6\" [label = \"NTT\"] \n\"6\"->\"7\" [label = \"NNN\"] \n\"1\"->\"8\" [label = \"TTT\"] \n\"8\"->\"9\" [label = \"NNN\"] \n\"2\"->\"10\" [label = \"NNT\"] \n\"4\"->\"11\" [label = \"NNT\"] \n\"6\"->\"12\" [label = \"NNT\"] \n\"8\"->\"13\" [label = \"NNT\"] \n\"2\"->\"14\" [label = \"NTT\"] \n\"4\"->\"15\" [label = \"NTT\"] \n\"6\"->\"16\" [label = \"NTT\"] \n\"8\"->\"17\" [label = \"NTT\"] \n\"2\"->\"18\" [label = \"TTT\"] \n\"4\"->\"19\" [label = \"TTT\"] \n\"6\"->\"20\" [label = \"TTT\"] \n\"8\"->\"21\" [label = \"TTT\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>We can see in several situations that the second model is more conservative in escalation, achieving the goal of the authors. Perhaps unexpectedly, however, the second design escalations to dose 11 after initial outcomes <code>2NNN</code>, slightly more aggessively than the default model which identifies dose 10.</p>
<p>Dose-paths can also be run for in-progress trials where some outcomes have been established. For more information on working with dose-paths, refer to the dose-paths vignette.</p>
</div>
<div id="simulation" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation" class="anchor"></a>Simulation</h2>
<p>We can use the <code>simulate_trials</code> function to calculate operating characteristics for a design. Let us take the example above, append it with behaviour to stop when the lowest dose is too toxic, when 9 patients have already been evaluated at the candidate dose, or when a sample size of <span class="math inline">\(n=24\)</span> is reached:</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="va">dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2.5</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">25</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span>, <span class="fl">75</span>, <span class="fl">100</span>, <span class="fl">150</span>, <span class="fl">200</span>, <span class="fl">250</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_trialr_nbg.html">get_trialr_nbg</a></span><span class="op">(</span>real_doses <span class="op">=</span> <span class="va">dose</span>, d_star <span class="op">=</span> <span class="fl">250</span>, target <span class="op">=</span> <span class="fl">0.3</span>,
                        alpha_mean <span class="op">=</span> <span class="fl">2.15</span>, alpha_sd <span class="op">=</span> <span class="fl">0.84</span>,
                        beta_mean <span class="op">=</span> <span class="fl">0.52</span>, beta_sd <span class="op">=</span> <span class="fl">0.8</span>,
                        seed <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/stop_when_too_toxic.html">stop_when_too_toxic</a></span><span class="op">(</span>dose <span class="op">=</span> <span class="fl">1</span>, tox_threshold <span class="op">=</span> <span class="fl">0.3</span>, confidence <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/stop_when_n_at_dose.html">stop_when_n_at_dose</a></span><span class="op">(</span>dose <span class="op">=</span> <span class="st">'recommended'</span>, n <span class="op">=</span> <span class="fl">9</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/stop_at_n.html">stop_at_n</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">24</span><span class="op">)</span></pre></div>
<p>For the sake of speed, we will run just ten iterations:</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="va">num_sims</span> <span class="op">&lt;-</span> <span class="fl">10</span></pre></div>
<p>In real life, however, we would naturally run many thousands of iterations.</p>
<p>Then let us investigate under the following true probabilities of toxicity:</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="va">sc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.03</span>, <span class="fl">0.10</span>, <span class="fl">0.17</span>, <span class="fl">0.25</span>, <span class="fl">0.35</span>, <span class="fl">0.45</span>, <span class="fl">0.53</span>, <span class="fl">0.60</span>, <span class="fl">0.65</span>, <span class="fl">0.69</span>, 
         <span class="fl">0.72</span>, <span class="fl">0.75</span>, <span class="fl">0.79</span>, <span class="fl">0.80</span><span class="op">)</span></pre></div>
<p>The simulated behaviour is:</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">sims</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/simulate_trials.html">simulate_trials</a></span><span class="op">(</span>num_sims <span class="op">=</span> <span class="va">num_sims</span>, true_prob_tox <span class="op">=</span> <span class="va">sc1</span>, next_dose <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">sims</span>
<span class="co">#&gt; Number of iterations: 10 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of doses: 15 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; True probability of toxicity:</span>
<span class="co">#&gt;    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15 </span>
<span class="co">#&gt; 0.01 0.03 0.10 0.17 0.25 0.35 0.45 0.53 0.60 0.65 0.69 0.72 0.75 0.79 0.80 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Probability of recommendation:</span>
<span class="co">#&gt; NoDose      1      2      3      4      5      6      7      8      9     10 </span>
<span class="co">#&gt;    0.0    0.0    0.0    0.0    0.2    0.2    0.3    0.3    0.0    0.0    0.0 </span>
<span class="co">#&gt;     11     12     13     14     15 </span>
<span class="co">#&gt;    0.0    0.0    0.0    0.0    0.0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Probability of administration:</span>
<span class="co">#&gt;      1      2      3      4      5      6      7      8      9     10     11 </span>
<span class="co">#&gt; 0.1282 0.0000 0.0128 0.1410 0.1667 0.1538 0.1026 0.0641 0.0897 0.1410 0.0000 </span>
<span class="co">#&gt;     12     13     14     15 </span>
<span class="co">#&gt; 0.0000 0.0000 0.0000 0.0000 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Sample size:</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;    21.0    24.0    24.0    23.4    24.0    24.0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Total toxicities:</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;    6.00    7.25    8.00    7.80    8.75    9.00 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Trial duration:</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;   17.20   21.70   22.80   22.32   23.20   24.60</span></pre></div>
<p>We see that the chances of stopping for excess toxicity and recommending no dose are low. Doses 4-7 are the favourites to be identified.</p>
<p>For more information on running dose-finding simulations, refer to the simulation vignette.</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-mozgunov_improving_2020">
<p>Mozgunov, Pavel, and Thomas Jaki. 2020. “Improving Safety of the Continual Reassessment Method via a Modified Allocation Rule.” <em>Statistics in Medicine</em> 39 (7): 906–22. <a href="https://doi.org/10.1002/sim.8450">https://doi.org/10.1002/sim.8450</a>.</p>
</div>
<div id="ref-Neuenschwander2008">
<p>Neuenschwander, Beat, Michael Branson, and Thomas Gsponer. 2008. “Critical aspects of the Bayesian approach to phase I cancer trials.” <em>Statistics in Medicine</em> 27: 2420–39. <a href="https://doi.org/10.1002/sim.3230">https://doi.org/10.1002/sim.3230</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kristian Brock.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
